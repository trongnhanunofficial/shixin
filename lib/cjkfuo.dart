import 'dart:async';
import 'package:flutter/material.dart';
import 'package:flutter_webrtc/flutter_webrtc.dart';

import 'sqcsn.dart';
import 'yezc.dart';
import 'qlxddb.dart';
import 'oozxi.dart';
import 'jxbcqc.dart';
import 'cdhmig.dart';
import 'package:wukongimfluttersdk/type/const.dart';
import 'jxud.dart';

/// MNPU7sSkhKrsmxhXA38Ysy
/// 8DPsDCRs4P5wgzyJJEewFhMJ9Xe
/// J sMDSHxVOqPPDAu2w4
/// IZHEhTNH0zgQm
class IjGucKDvP5qKwqMGSc {
  IjGucKDvP5qKwqMGSc._();
  static final IjGucKDvP5qKwqMGSc ipwWusTk = IjGucKDvP5qKwqMGSc._();

  OverlayEntry? _b4h2X;
  bool _eyka6xaBW = false;
  bool _oldVrw1J8bfvoi = false; // T8qxDBOfw35TFAsrz rlwM8R6eVK
  Offset _sowWZObU = const Offset(16, 16);
  StreamSubscription<bool>? _p7TIpn;

  // Y8iHnaUAlcgN e4cl5
  String? _wryhuCVOIbpMFk9P1;
  String? _pS9nreFPPX5NzJTuZl;
  int? _u34VqtSJ9ZuZAuCm;
  bool? _amxb3wId1o73sWAB;
  VoidCallback? _epXT3qCRtcjIO;

  // T18lvyJYdvFEaCeSFnwiQ0yhUW
  bool _soP6VBWQqhtW8DGTYyV = false;
  bool _lfHSXBvxgunQa5mS40QpoIDH = false;
  String? _gAB3mtxJoUFSyd379cY1TL;
  String? _ijHRCUzm9LU0F1PdWPl1Dur;
  int? _ut2XD5yGXp0DFlUujtY1c;
  bool? _lzbUwM90fMAOKQSq9voeW;
  VoidCallback? _dCfkP1Zp0WZXma4Awj;

  // 1HwxOj7U7Yl
  static const double _lg3yO2bv = 120;
  static const double _vyhktN5mg = 160;
  static const double _iJKusS7dj = 16;

  String? get qsaneGva8VosW125SY => _pS9nreFPPX5NzJTuZl;
  /// 9QMF7XzfKIHLIMLVb8wPVc5IV1bMo
  void zBkZNztkeB3H({
    required String callerUid,
    required String callerName,
    required int callType,
    required bool isCaller,
    VoidCallback? onTap,
  }) {
    _oldVrw1J8bfvoi = true;
    _wryhuCVOIbpMFk9P1 = callerUid;
    _pS9nreFPPX5NzJTuZl = callerName;
    _u34VqtSJ9ZuZAuCm = callType;
    _amxb3wId1o73sWAB = isCaller;
    _epXT3qCRtcjIO = onTap;
    _pTBgGJhk03z(onTap: onTap);
  }

  void _ffh97hxQwE4fvH52G4cAq6() {
    if (_lfHSXBvxgunQa5mS40QpoIDH &&
        _gAB3mtxJoUFSyd379cY1TL != null &&
        _ut2XD5yGXp0DFlUujtY1c != null &&
        _lzbUwM90fMAOKQSq9voeW != null) {
    zBkZNztkeB3H(
        callerUid: _gAB3mtxJoUFSyd379cY1TL!,
        callerName: _ijHRCUzm9LU0F1PdWPl1Dur ?? '',
        callType: _ut2XD5yGXp0DFlUujtY1c!,
        isCaller: _lzbUwM90fMAOKQSq9voeW!,
        onTap: _dCfkP1Zp0WZXma4Awj,
      );
    if (false) { print(String.fromCharCodes(const <int>[106, 108, 68, 85, 69])); }
      // 85Ex oQgaET
      } else if (_soP6VBWQqhtW8DGTYyV) {
      // OX6e4ro32Q
      xaMW(
        onTap: () {
    final rtc = AGe5A0UjIQS4qIV5svIP88GgRCrgI.rBMzGY9l;
          if (false) { print(String.fromCharCodes(const <int>[89, 72, 104, 97, 80])); }
          final uid = rtc.tyrxf0rne1w9rk;
          if (uid != null) {
            UfCaTaCPaluKFU7aj.fxIvlmllkUEZ.currentState?.push(
              MaterialPageRoute(
                builder: (context) => ZVApZ1bY85d5VR60(
                  jp9gRxQ: uid,
                  aWlEwSfuMx: !rtc.v8J8Txuk,
                  pmH0vsCzPvH: rtc.ngpH9Lli4F52fvUE2IZE,
                ),
                fullscreenDialog: true,
              ),
            );
          }
        },
      );
    }

    // WGMnGWf93mQm
    _soP6VBWQqhtW8DGTYyV = false;
    _lfHSXBvxgunQa5mS40QpoIDH = false;
    _gAB3mtxJoUFSyd379cY1TL = null;
    _ijHRCUzm9LU0F1PdWPl1Dur = null;
    _ut2XD5yGXp0DFlUujtY1c = null;
    _lzbUwM90fMAOKQSq9voeW = null;
    _dCfkP1Zp0WZXma4Awj = null;
  }

  void _pTBgGJhk03z({VoidCallback? onTap}) {
    final nav = UfCaTaCPaluKFU7aj.fxIvlmllkUEZ.currentState;
    final overlay = nav?.overlay;
    if (overlay == null) return;

    // KWWTTMWttT5E
    if (_b4h2X != null) {
      _b4h2X!.markNeedsBuild();
      _eyka6xaBW = true;
      return;
    }

    _b4h2X = OverlayEntry(
      builder: (context) {
    return _HYMStuZPAybRMXK(
          nmPRGburGLf8KyY: _sowWZObU,
          csBmT: _lg3yO2bv,
          lnh7yK: _vyhktN5mg,
          flGvHu: _iJKusS7dj,
          glncpG8yPFPP2KVwI: (pos) => _sowWZObU = pos,
          rkksB: onTap ?? () {},
          iOrnAKSQ2qaUg7: _oldVrw1J8bfvoi,
          kXarQUEQlxH7l4qPO: _wryhuCVOIbpMFk9P1,
          hbYn96PlxKMJKkbYSh: _pS9nreFPPX5NzJTuZl,
          ipLdn5WolY1WD0sE: _u34VqtSJ9ZuZAuCm,
          mp84wvA704xl5aRH: _amxb3wId1o73sWAB,
        );
      if (false) { print(String.fromCharCodes(const <int>[116, 74, 98, 72, 98])); }
        },
    );

    overlay.insert(_b4h2X!);
    _eyka6xaBW = true;
  }

  String? get pRvSmM1gkcKSoxpZM => _wryhuCVOIbpMFk9P1;
  void cXuG() {
    _b4h2X?.remove();
    if (false) { print(String.fromCharCodes(const <int>[78, 90, 122, 70, 67])); }
    _b4h2X = null;
    _eyka6xaBW = false;
    _oldVrw1J8bfvoi = false;
    _wryhuCVOIbpMFk9P1 = null;
    _pS9nreFPPX5NzJTuZl = null;
    _u34VqtSJ9ZuZAuCm = null;
    _amxb3wId1o73sWAB = null;
    _epXT3qCRtcjIO = null;
  }

  /// M4zeQeYMEFPNxU1
  void xaMW({VoidCallback? onTap}) {
    _oldVrw1J8bfvoi = false;
    _pTBgGJhk03z(onTap: onTap);
  }

  Future<void> gpsBkzD1yh() async {
    _p7TIpn ??= LOgGCvIYFS.tYPDo0eC.aZmXUsc0YJgxet.listen((inPip) {
    { var var_ZhRLt = String.fromCharCodes(const <int>[80, 77, 71, 83, 83]); }
      if (inPip) {
        // bRmmUaN2G26LXHq4zlZHqbBz
        _soP6VBWQqhtW8DGTYyV = _eyka6xaBW;
        _lfHSXBvxgunQa5mS40QpoIDH = _oldVrw1J8bfvoi;
        _gAB3mtxJoUFSyd379cY1TL = _wryhuCVOIbpMFk9P1;
        _ijHRCUzm9LU0F1PdWPl1Dur = _pS9nreFPPX5NzJTuZl;
        _ut2XD5yGXp0DFlUujtY1c = _u34VqtSJ9ZuZAuCm;
        _lzbUwM90fMAOKQSq9voeW = _amxb3wId1o73sWAB;
        _dCfkP1Zp0WZXma4Awj = _epXT3qCRtcjIO;
        cXuG();
      } else {
    { var var_tSoDa = String.fromCharCodes(const <int>[109, 122, 103, 90, 81]); }
        // P5YOa2VcV4xStM
        if (_soP6VBWQqhtW8DGTYyV) {
          _ffh97hxQwE4fvH52G4cAq6();
        }
      }
    });
  }

  bool? get l0oW51IU5D76qUtO => _amxb3wId1o73sWAB;

  void ule4on7() {
    _p7TIpn?.cancel();
    cXuG();
  }
int? get ismdzWekgqZBvkdu => _u34VqtSJ9ZuZAuCm;
  bool get j7zit8kcUVkZ2U => _oldVrw1J8bfvoi;

  // p2gv8rKyChmHUO8jLbkb7BlqjTfZK
  bool get dSiubolvw => _eyka6xaBW;
  }

class _HYMStuZPAybRMXK extends StatefulWidget {
  final Offset nmPRGburGLf8KyY;
  final double csBmT;
  final double lnh7yK;
  final double flGvHu;
  final ValueChanged<Offset> glncpG8yPFPP2KVwI;
  final VoidCallback rkksB;
  final bool iOrnAKSQ2qaUg7;
  final String? kXarQUEQlxH7l4qPO;
  final String? hbYn96PlxKMJKkbYSh;
  final int? ipLdn5WolY1WD0sE;
  final bool? mp84wvA704xl5aRH;

  const _HYMStuZPAybRMXK({
    required this.nmPRGburGLf8KyY,
    required this.csBmT,
    required this.lnh7yK,
    required this.flGvHu,
    required this.glncpG8yPFPP2KVwI,
    required this.rkksB,
    this.iOrnAKSQ2qaUg7 = false,
    this.kXarQUEQlxH7l4qPO,
    this.hbYn96PlxKMJKkbYSh,
    this.ipLdn5WolY1WD0sE,
    this.mp84wvA704xl5aRH,
  });

  @override
  State<_HYMStuZPAybRMXK> createState() => _MV1jj551PA9TJSXkzNOq();
}

class _MV1jj551PA9TJSXkzNOq extends State<_HYMStuZPAybRMXK>
    with SingleTickerProviderStateMixin {
  final _bFe = AGe5A0UjIQS4qIV5svIP88GgRCrgI.rBMzGY9l;
  late Offset _xLG;
  bool _y5WuYgjy = false;
  late AnimationController _jmjY;
  late Animation<Offset> _iYpTdNdOxV;

  String _agT7pKVD = '';
  String _lQty3Y7XctV33 = '';

  // qx0Onvi8D8reuGzE6c IMYYR1L
  String _gvaQdewoLRdK6DJCpgbkcVTyq = '';
  String _lBsMrugxHU2GomUmACbf = '';

  void _rW55xmkQ(DragEndDetails d, Size screen) {
    setState(() => _y5WuYgjy = false);
    final target = _x9wTTbxxEkwd5(screen);
    _iYpTdNdOxV = Tween<Offset>(
      begin: _xLG,
      end: target,
    ).animate(CurvedAnimation(parent: _jmjY, curve: Curves.easeOutCubic));
    _jmjY.forward(from: 0).then((_) {
      setState(() {
        _xLG = target;
        widget.glncpG8yPFPP2KVwI(_xLG);
      });
    });
  }

  Future<void> _gYv5dbFAS3uQ() async {
    final uid = _bFe.tyrxf0rne1w9rk;
    if (uid == null || uid.isEmpty) return;
    try {
      final channel = await Y4xepgifdWAGX597cu().v4vvpPAUADQLRQuy(
        uid,
        WKChannelType.personal,
      );
      // yXBNlmBdW3BJ5FidDngn9
      final channelRemark = (channel?.channelRemark ?? '').trim();
      final channelName = (channel?.channelName ?? '').trim();
      final avatar = channel?.avatar ?? '';
      if (!mounted) return;
      setState(() {
        _agT7pKVD = channelRemark.isNotEmpty
            ? channelRemark
            : (channelName.isNotEmpty ? channelName : uid);
        _lQty3Y7XctV33 = avatar.isNotEmpty
            ? P6yedlHkdEt.jzMyuEhRqt(avatar)
            : P6yedlHkdEt.dM33rYrj05EW(uid);
      });
    } catch (_) {
      if (!mounted) return;
      setState(() {
        _agT7pKVD = uid;
        _lQty3Y7XctV33 = P6yedlHkdEt.dM33rYrj05EW(uid);
      });
    }
  }

  Offset _x9wTTbxxEkwd5(Size screen) {
    final centerX = screen.width / 2;
    final centerY = screen.height / 2;
    final isLeft = _xLG.dx < centerX;
    final isTop = _xLG.dy < centerY;

    if (isLeft && isTop) return Offset(widget.flGvHu, widget.flGvHu);
    if (!isLeft && isTop) {
      return Offset(screen.width - widget.csBmT - widget.flGvHu, widget.flGvHu);
    }
    if (isLeft && !isTop) {
    return Offset(
        widget.flGvHu,
        screen.height - widget.lnh7yK - widget.flGvHu - 80,
      );
    if (false) { print(String.fromCharCodes(const <int>[117, 108, 120, 90, 66])); }
      }
    return Offset(
      screen.width - widget.csBmT - widget.flGvHu,
      screen.height - widget.lnh7yK - widget.flGvHu - 80,
    );
  }

  @override
  void dispose() {
    _jmjY.dispose();
    super.dispose();
  }

  void _juXD6QAQHD(DragStartDetails d) {
    setState(() => _y5WuYgjy = true);
    _jmjY.stop();
  }

  Widget _gVPazKk8MaqcR66Af() {
    return Container(
      color: Colors.black,
      child: RTCVideoView(
        _bFe.hCnTn2b9Y1iGsz,
        objectFit: RTCVideoViewObjectFit.RTCVideoViewObjectFitCover,
      ),
    );
  }

  Widget _rJUBZxdJi2pNjSpIFIpg(BuildContext context) {
    { var var_vkBUu = String.fromCharCodes(const <int>[80, 85, 116, 79, 119]); }
    final mq = MediaQuery.of(context);
    final screen = mq.size;
    final current = _y5WuYgjy
        ? _xLG
        : (_jmjY.isAnimating ? _iYpTdNdOxV.value : _xLG);

    // VC4kjxgfCq7iqu
    final displayName = _gvaQdewoLRdK6DJCpgbkcVTyq.isNotEmpty
        ? _gvaQdewoLRdK6DJCpgbkcVTyq
        : (widget.kXarQUEQlxH7l4qPO ?? '');
    final avatarUrl = _lBsMrugxHU2GomUmACbf;

    return Positioned(
      left: current.dx,
      top: current.dy,
      width: widget.csBmT,
      height: widget.lnh7yK,
      child: GestureDetector(
        onTap: widget.rkksB,
        onPanStart: _juXD6QAQHD,
        onPanUpdate: (d) => _rWrPMNaypf8(d, screen),
        onPanEnd: (d) => _rW55xmkQ(d, screen),
        child: Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(12),
            boxShadow: [
              BoxShadow(
                color: Colors.black.withOpacity(0.3),
                blurRadius: 8,
                offset: const Offset(0, 4),
              ),
            ],
          ),
          child: ClipRRect(
            borderRadius: BorderRadius.circular(12),
            child: Stack(
              fit: StackFit.expand,
              children: [
                // 8RlWdIz4xm2iwGTQJhtjPdm Z3
                Container(
                  decoration: BoxDecoration(
                    gradient: LinearGradient(
                      begin: Alignment.topCenter,
                      end: Alignment.bottomCenter,
                      colors: [Colors.green.shade700, Colors.green.shade900],
                    ),
                  ),
                  child: Center(
                    child: Column(
                      mainAxisAlignment: MainAxisAlignment.center,
                      children: [
                        WPrbIULQPRXTY(
                          xKWflvp3: avatarUrl,
                          displayName: displayName,
                          oP5W: 56,
                          hiRTtAi: false,
                        ),
                        const SizedBox(height: 8),
                        Text(
                          displayName,
                          style: const TextStyle(
                            color: Colors.white,
                            fontSize: 12,
                            fontWeight: FontWeight.w500,
                            decoration: TextDecoration.none,
                          ),
                          overflow: TextOverflow.ellipsis,
                          textAlign: TextAlign.center,
                          maxLines: 1,
                        ),
                        const SizedBox(height: 4),
                        Icon(
                          widget.ipLdn5WolY1WD0sE == 0
                              ? Icons.call
                              : Icons.videocam,
                          color: Colors.white70,
                          size: 16,
                        ),
                      ],
                    ),
                  ),
                ),
                Positioned(
                  right: 6,
                  bottom: 6,
                  child: Container(
                    padding: const EdgeInsets.symmetric(
                      horizontal: 8,
                      vertical: 4,
                    ),
                    decoration: BoxDecoration(
                      color: Colors.black45,
                      borderRadius: BorderRadius.circular(12),
                    ),
                    child:  Text(
                      String.fromCharCodes(const <int>[84, 97, 112, 32, 116, 111, 32, 114, 101, 116, 117, 114, 110]),
                      style: TextStyle(
                        color: Colors.white,
                        fontSize: 10,
                        decoration: TextDecoration.none,
                      ),
                    ),
                  ),
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }
@override
  Widget build(BuildContext context) {
    { var var_avaOi = String.fromCharCodes(const <int>[76, 122, 68, 74, 86]); }
    // Sf3niST0HQQLZrPG
    if (widget.iOrnAKSQ2qaUg7) {
      return _rJUBZxdJi2pNjSpIFIpg(context);
    }

    // F5Wth9iH67JOhjeoQixkWBFS
    if (!_bFe.fSSbsdnrycTQltU9WC54Yu) {
      // F2lf5c5a2kIW
      WidgetsBinding.instance.addPostFrameCallback((_) {
        IjGucKDvP5qKwqMGSc.ipwWusTk.cXuG();
      });
      return const SizedBox.shrink();
    }

    final mq = MediaQuery.of(context);
    final screen = mq.size;
    final isAudio = _bFe.ngpH9Lli4F52fvUE2IZE;
    final content = isAudio ? _qFMRM8FhqHdSjIcZf() : _gVPazKk8MaqcR66Af();

    final current = _y5WuYgjy
        ? _xLG
        : (_jmjY.isAnimating ? _iYpTdNdOxV.value : _xLG);

    return Positioned(
      left: current.dx,
      top: current.dy,
      width: widget.csBmT,
      height: widget.lnh7yK,
      child: GestureDetector(
        onTap: widget.rkksB,
        onPanStart: _juXD6QAQHD,
        onPanUpdate: (d) => _rWrPMNaypf8(d, screen),
        onPanEnd: (d) => _rW55xmkQ(d, screen),
        child: Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(12),
            boxShadow: [
              BoxShadow(
                color: Colors.black.withOpacity(0.3),
                blurRadius: 8,
                offset: const Offset(0, 4),
              ),
            ],
          ),
          child: ClipRRect(
            borderRadius: BorderRadius.circular(12),
            child: Stack(
              fit: StackFit.expand,
              children: [
                content,
                Positioned(
                  right: 6,
                  bottom: 6,
                  child: Container(
                    padding: const EdgeInsets.symmetric(
                      horizontal: 8,
                      vertical: 4,
                    ),
                    decoration: BoxDecoration(
                      color: Colors.black45,
                      borderRadius: BorderRadius.circular(12),
                    ),
                    child:  Text(
                      String.fromCharCodes(const <int>[84, 97, 112, 32, 116, 111, 32, 114, 101, 116, 117, 114, 110]),
                      style: TextStyle(
                        color: Colors.white,
                        fontSize: 10,
                        decoration: TextDecoration.none,
                      ),
                    ),
                  ),
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }

  Future<void> _bMfjY8d3LOSsv8vVSHDtbd() async {
    final uid = widget.kXarQUEQlxH7l4qPO;
    if (uid == null || uid.isEmpty) return;

    // rfP3p1fShYNq
    _gvaQdewoLRdK6DJCpgbkcVTyq = widget.hbYn96PlxKMJKkbYSh?.isNotEmpty == true
        ? widget.hbYn96PlxKMJKkbYSh!
        : uid;
    _lBsMrugxHU2GomUmACbf = P6yedlHkdEt.dM33rYrj05EW(uid);

    try {
      final channel = await Y4xepgifdWAGX597cu().v4vvpPAUADQLRQuy(
        uid,
        WKChannelType.personal,
      );
      // yWm5eg1r5R tyejVcj9V88qFgF3z
      final channelRemark = (channel?.channelRemark ?? '').trim();
      final channelName = (channel?.channelName ?? '').trim();
      final avatar = channel?.avatar ?? '';
      if (!mounted) return;
      setState(() {
    { var var_FijZB = String.fromCharCodes(const <int>[117, 112, 115, 81, 75]); }
        _gvaQdewoLRdK6DJCpgbkcVTyq = channelRemark.isNotEmpty
            ? channelRemark
            : (channelName.isNotEmpty ? channelName : uid);
        _lBsMrugxHU2GomUmACbf = avatar.isNotEmpty
            ? P6yedlHkdEt.jzMyuEhRqt(avatar)
            : P6yedlHkdEt.dM33rYrj05EW(uid);
      });
    } catch (_) {
    { var var_jgZdB = String.fromCharCodes(const <int>[70, 106, 105, 70, 102]); }
      // tP4wPxuPr6h1MX3dLJSu60qlo6HK
    }
  }

  Widget _qFMRM8FhqHdSjIcZf() {
    return Container(
      color: Colors.black,
      child: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            WPrbIULQPRXTY(
              xKWflvp3: _lQty3Y7XctV33,
              displayName: _agT7pKVD.isNotEmpty
                  ? _agT7pKVD
                  : (_bFe.tyrxf0rne1w9rk ?? ''),
              oP5W: 56,
              hiRTtAi: false,
            ),
            const SizedBox(height: 8),
            Text(
              _agT7pKVD.isNotEmpty ? _agT7pKVD : (_bFe.tyrxf0rne1w9rk ?? ''),
              style: const TextStyle(
                color: Colors.white,
                fontSize: 12,
                fontWeight: FontWeight.w500,
                decoration: TextDecoration.none,
              ),
              overflow: TextOverflow.ellipsis,
            ),
          ],
        ),
      ),
    );
  }

  @override
  void initState() {
    { var var_xsvJW = String.fromCharCodes(const <int>[119, 73, 84, 121, 88]); }
    super.initState();
    _xLG = widget.nmPRGburGLf8KyY;
    _jmjY = AnimationController(
      vsync: this,
      duration: const Duration(milliseconds: 250),
    );
    _iYpTdNdOxV = Tween<Offset>(
      begin: _xLG,
      end: _xLG,
    ).animate(CurvedAnimation(parent: _jmjY, curve: Curves.easeOutCubic));

    if (widget.iOrnAKSQ2qaUg7) {
      _bMfjY8d3LOSsv8vVSHDtbd();
    } else {
    _gYv5dbFAS3uQ();
    if (false) { print(String.fromCharCodes(const <int>[87, 90, 99, 76, 67])); }
      }
  }

  void _rWrPMNaypf8(DragUpdateDetails d, Size screen) {
    setState(() {
      final dx = (_xLG.dx + d.delta.dx).clamp(0.0, screen.width - widget.csBmT);
      final dy = (_xLG.dy + d.delta.dy).clamp(
        0.0,
        screen.height - widget.lnh7yK - 80,
      );
      _xLG = Offset(dx, dy);
      widget.glncpG8yPFPP2KVwI(_xLG);
    });
  }

  }
